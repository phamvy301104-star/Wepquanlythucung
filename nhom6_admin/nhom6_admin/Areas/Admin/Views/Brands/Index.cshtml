@{ ViewData["Title"] = "Quản lý thương hiệu"; }

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h4 class="mb-1"><i class="fas fa-tags text-primary mr-2"></i>Quản lý thương hiệu</h4>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="@Url.Action("Index", "Dashboard", new { area = "Admin" })">Dashboard</a></li>
                <li class="breadcrumb-item active">Thương hiệu</li>
            </ol>
        </nav>
    </div>
    <a href="@Url.Action("Create")" class="btn btn-primary"><i class="fas fa-plus mr-1"></i>Thêm thương hiệu</a>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show">
        <i class="fas fa-check-circle mr-2"></i>@TempData["SuccessMessage"]
        <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
    </div>
}

<div class="card">
    <div class="card-header">
        <div class="row">
            <div class="col-md-4">
                <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm...">
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-primary" id="btnFilter"><i class="fas fa-search"></i></button>
            </div>
        </div>
    </div>
    <div class="card-body">
        <table id="brandsTable" class="table table-bordered table-striped">
            <thead class="thead-dark">
                <tr>
                    <th>#</th>
                    <th>Logo</th>
                    <th>Tên thương hiệu</th>
                    <th>Mô tả</th>
                    <th>Sản phẩm</th>
                    <th>Thứ tự</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">Xác nhận xóa</h5>
                <button type="button" class="close text-white" data-dismiss="modal"><span>&times;</span></button>
            </div>
            <div class="modal-body">Bạn có chắc chắn muốn xóa thương hiệu <strong id="deleteName"></strong>?</div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">Xóa</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css">
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap4.min.js"></script>
<script>
    var table, deleteId;
    $(document).ready(function () {
        table = $('#brandsTable').DataTable({
            processing: true, serverSide: true,
            ajax: { url: '@Url.Action("GetData")', type: 'GET', data: d => { d.search = $('#searchInput').val(); } },
            columns: [
                { data: null, orderable: false, render: (d, t, r, m) => m.row + m.settings._iDisplayStart + 1 },
                { data: 'logoUrl', orderable: false, render: d => '<img src="' + (d || 'https://via.placeholder.com/50') + '" class="img-thumbnail" style="width:50px;height:50px;object-fit:contain;">' },
                { data: 'name', render: d => '<strong>' + d + '</strong>' },
                { data: 'description', render: d => d ? (d.length > 50 ? d.substring(0, 50) + '...' : d) : '-' },
                { data: 'productCount', render: d => '<span class="badge badge-info">' + d + '</span>' },
                { data: 'displayOrder' },
                { data: 'isActive', orderable: false, render: (d, t, r) => '<div class="custom-control custom-switch"><input type="checkbox" class="custom-control-input toggle-active" id="active_' + r.id + '" data-id="' + r.id + '" ' + (d ? 'checked' : '') + '><label class="custom-control-label" for="active_' + r.id + '"></label></div>' },
                { data: null, orderable: false, render: (d, t, r) => '<div class="btn-group btn-group-sm"><a href="@Url.Action("Edit")/' + r.id + '" class="btn btn-warning"><i class="fas fa-edit"></i></a><button class="btn btn-danger btn-delete" data-id="' + r.id + '" data-name="' + r.name + '"><i class="fas fa-trash"></i></button></div>' }
            ],
            language: { processing: '<i class="fas fa-spinner fa-spin fa-2x"></i>', lengthMenu: 'Hiển thị _MENU_', zeroRecords: 'Không có dữ liệu', info: '_START_ - _END_ / _TOTAL_', search: 'Tìm:' }
        });

        $('#btnFilter').click(() => table.ajax.reload());
        $('#searchInput').keypress(e => { if (e.which === 13) table.ajax.reload(); });
        $(document).on('change', '.toggle-active', function () {
            $.post('@Url.Action("ToggleActive")/' + $(this).data('id'), res => { if (res.success) toastr.success('Đã cập nhật!'); else toastr.error('Lỗi'); });
        });
        $(document).on('click', '.btn-delete', function () { deleteId = $(this).data('id'); $('#deleteName').text($(this).data('name')); $('#deleteModal').modal('show'); });
        $('#confirmDelete').click(() => {
            $.post('@Url.Action("Delete")/' + deleteId, res => { if (res.success) { toastr.success(res.message); table.ajax.reload(); } else toastr.error(res.message); $('#deleteModal').modal('hide'); });
        });
    });
</script>
}
